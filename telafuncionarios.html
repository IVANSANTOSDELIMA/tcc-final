<!DOCTYPE html>
<html lang="pt-br">

<head>
  <!-- Meta tags para configuração básica da página -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon da página -->
  <link rel="shortcut icon" href="css/img/logoAtualizada.png" type="image/x-icon" />

  <!-- Folha de estilo principal do sistema -->
  <link rel="stylesheet" href="css/telafuncionarios.css" />

  <!-- Importação da fonte Inter -->
  <link rel="preconnect" href="https://rsms.me/" />
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

  <!-- Importação de diversos ícones da biblioteca Flaticon -->
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-straight/css/uicons-regular-straight.css" />
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.6.0/uicons-thin-rounded/css/uicons-thin-rounded.css" />
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.6.0/uicons-thin-chubby/css/uicons-thin-chubby.css" />
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css" />
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-straight/css/uicons-solid-straight.css" />
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.6.0/uicons-tdin-rounded/css/uicons-tdin-rounded.css" />
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-straight/css/uicons-regular-straight.css" />
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-bold-straight/css/uicons-bold-straight.css" />
  <link rel="stylesheet"
    href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css" />

  <!-- Script para autenticação -->
  <script type="module" src="integracoes\authMiddleware.js"></script>

  <!-- Biblioteca de gráficos ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <!-- Título da página -->
  <title>Cerealista Souza</title>
</head>

<body>
  <!-- Container principal da página -->
  <div class="containerTotal">
    <!-- Menu lateral de navegação -->
    <div class="containerButtons">
      <!-- Logo da empresa -->
      <img src="css/img/Logotipo-Cerealista.png" alt="logoLetra" id="logo" />

      <!-- Botões de navegação do sistema -->
      <div class="rowbutton">
        <i class="fi fi-rs-apps"></i>
        <button type="button" onclick="window.location.href='telaInicio.html'">
          Dashboard
        </button>
        <i class="fi fi-ss-angle-right" style="font-size: 20px; position: absolute; top: 45%; left: 65%"></i>
      </div>
      <div class="rowbutton">
        <i class="fi fi-tr-users"></i>
        <button type="button" onclick="window.location.href='telafuncionarios.html'">
          Funcionarios
        </button>
      </div>
      <div class="rowbutton">
        <i class="fi fi-tr-boxes"></i>
        <button type="button" onclick="window.location.href='telaprodutos.html'">
          Estoque
        </button>
        <i class="fi fi-ss-angle-right" style="font-size: 20px; position: absolute; top: 45%; left: 55%"></i>
      </div>
      <div class="rowbutton">
        <i class="fi fi-tr-chart-line-up"></i>
        <button type="button" onclick="window.location.href='telarelatoriodeProdutos.html'">
          Movimentações
        </button>
        <i class="fi fi-ss-angle-right" style="font-size: 20px; position: absolute; top: 45%; left: 80%"></i>
      </div>
      <div class="rowbutton">
        <i class="fi fi-rr-shopping-bag"></i>
        <button type="button" onclick="window.location.href='telaAddPedido.html'">
          Pedidos
        </button>
        <i class="fi fi-ss-angle-right" style="font-size: 20px; position: absolute; top: 45%; left: 55%"></i>
      </div>
    </div>

    <!-- Cabeçalho superior com informações do usuário -->
    <header id="headersuperior">
      <div class="config">
        <div id="imageUser"><img src="" alt="" /></div>
      </div>
    </header>

    <!-- Container principal de conteúdo -->
    <div class="container">
      <!-- Bloco de filtros para a tabela de funcionários -->
      <div class="filtros-bloco">
        <div id="buttonCategory">
          <!-- Botão para adicionar novo funcionário -->
          <div class="category-column-1">
            <button id="openButton">+</button>
          </div>
          <!-- Filtro por nome -->
          <div class="category-column">
            <label for="NomeCategoria"><strong>Nome</strong></label>
            <input type="search" name="NomeCategory" class="inputCtg" id="filtro-nome"
              placeholder="nome do funcionário" />
          </div>
          <!-- Filtro por cargo -->
          <div class="category-column">
            <label for="cargos"><strong>Cargo</strong></label>
            <select name="cargos" class="inputCtg" id="filtro-cargo">
              <option value="">Todos os cargos</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Tabela de exibição dos funcionários -->
      <div id="headertable">
        <table id="table" cellspacing="0" cellpadding="5">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cargo</th>
              <th>Telefone</th>
              <th>Email</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- Linhas dos funcionários serão inseridas aqui dinamicamente via JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal para adicionar/editar funcionários -->
    <dialog id="modalDialog">
      <!-- Botão para fechar o modal -->
      <button id="closeModal"><i class="fi fi-bs-cross"></i></button>

      <!-- Formulário de adição/edição de funcionário -->
      <!-- Nota: Comentário original indica que havia um <form> tag aqui -->

      <!-- Linha 1: Nome e Nível de Acesso -->
      <div class="form-row" id="line-0">
        <div class="form-column">
          <label for="nome">Nome: *</label>
          <input type="text" id="nome" name="nome" required />
        </div>
        <div class="form-column">
          <label for="nivelAcesso">Nível de acesso: *</label>
          <input type="text" id="nivelAcesso" name="nivelAcesso" required />
        </div>
      </div>

      <!-- Linha 2: CPF, Cargo e Data de Admissão -->
      <div class="form-row" id="line-1">
        <div class="form-column">
          <label for="cpf">CPF: *</label>
          <input type="text" id="cpf" name="cpf" required />
        </div>
        <div class="form-column">
          <label for="cargo">Cargo: *</label>
          <input type="text" id="cargo" name="cargo" required />
        </div>
        <div class="form-column">
          <label for="dataAdmissao">Data de Admissão: *</label>
          <input type="date" id="dataAdmissao" name="dataAdmissao" required />
        </div>
      </div>

      <!-- Linha 3: Telefone e Email -->
      <div class="form-row" id="line-2">
        <div class="form-column">
          <label for="telefone">Telefone: *</label>
          <input type="tel" id="telefone" name="telefone" required />
        </div>
        <div class="form-column">
          <label for="email">Email: *</label>
          <input type="email" id="email" name="email" required />
        </div>
      </div>

      <!-- Linha 4: Estado, Cidade e CEP -->
      <div class="form-row" id="line-3">
        <div class="form-column">
          <label for="cep">CEP: *</label>
          <input type="text" id="cep" name="cep" required />
        </div>
        <div class="form-column">
          <label for="estado">Estado: *</label>
          <input type="text" id="estado" name="estado" required />
        </div>
        <div class="form-column">
          <label for="cidade">Cidade: *</label>
          <input type="text" id="cidade" name="cidade" required />
        </div>
      </div>

      <!-- Linha 5: Rua -->
      <div class="form-row" id="line-4">
        <div class="form-column">
          <label for="rua">Rua: *</label>
          <input type="text" id="rua" name="rua" required />
        </div>
        <!-- Bloco adicional para Bairro e Número -->
        <div id="line-4-1">
          <div class="form-column">
            <label for="bairro">Bairro: *</label>
            <input type="text" id="bairro" name="bairro" required />
          </div>
          <div class="form-column">
            <label for="numero">Número: *</label>
            <input type="text" id="numero" name="numero" required />
          </div>
        </div>
      </div>

      <!-- Área de preview da imagem -->
      <div class="preview">
        <img id="preview-selected-image" />
      </div>

      <!-- Upload de imagem -->
      <div class="preview-imagem-container">
        <input type="file" id="file-upload" name="file" accept="image/*" onchange="previewImage(event)" required />
      </div>

      <!-- Linha 6: Complemento e Senha -->
      <div class="form-row" id="line-5">
        <div class="form-column">
          <label for="complemento">Complemento: </label>
          <textarea id="complemento" name="complemento"></textarea>
        </div>
        <div class="form-column">
          <label for="senha">Senha: *</label>
          <input type="password" id="senha" name="senha" required />
        </div>
      </div>

      <!-- Botão de confirmação para submeter o formulário -->
      <button id="submitform" type="submit">Confirmar</button>
      <!-- Nota: A tag form está comentada no código original -->
    </dialog>

    <!-- Modal para visualizar detalhes de um funcionário (somente leitura) -->
    <dialog id="modalVisualizarDialog">
      <!-- Botão para fechar o modal de visualização -->
      <button id="closeModalVisualizar">
        <i class="fi fi-bs-cross"></i>
      </button>

      <!-- Exibição dos dados do funcionário (todos em modo somente leitura) -->
      <!-- Linha 1: Nome e Nível de Acesso -->
      <div class="form-row" id="line-0b">
        <div class="form-column">
          <label>Nome:</label>
          <input type="text" id="visualizar-nome" readonly />
        </div>
        <div class="form-column">
          <label>Nível de acesso:</label>
          <input type="text" id="visualizar-nivelAcesso" readonly />
        </div>
      </div>

      <!-- Linha 2: CPF, Cargo e Data de Admissão -->
      <div class="form-row" id="line-1b">
        <div class="form-column">
          <label>CPF:</label>
          <input type="text" id="visualizar-cpf" readonly />
        </div>
        <div class="form-column">
          <label>Cargo:</label>
          <input type="text" id="visualizar-cargo" readonly />
        </div>
        <div class="form-column">
          <label>Data de Admissão:</label>
          <input type="date" id="visualizar-dataAdmissao" readonly />
        </div>
      </div>

      <!-- Linha 3: Telefone e Email -->
      <div class="form-row" id="line-2b">
        <div class="form-column">
          <label>Telefone:</label>
          <input type="tel" id="visualizar-telefone" readonly />
        </div>
        <div class="form-column">
          <label>Email:</label>
          <input type="email" id="visualizar-email" readonly />
        </div>
      </div>

      <!-- Linha 4: Estado, Cidade e CEP -->
      <div class="form-row" id="line-3b">
        <div class="form-column">
          <label>Estado:</label>
          <input type="text" id="visualizar-estado" readonly />
        </div>
        <div class="form-column">
          <label>Cidade:</label>
          <input type="text" id="visualizar-cidade" readonly />
        </div>
        <div class="form-column">
          <label>CEP:</label>
          <input type="text" id="visualizar-cep" readonly />
        </div>
      </div>

      <!-- Linha 5: Rua, Bairro e Número -->
      <div class="form-row" id="line-4b">
        <div class="form-column">
          <label>Rua:</label>
          <input type="text" id="visualizar-rua" readonly />
        </div>
        <div id="line-4-1b">
          <div class="form-column">
            <label>Bairro:</label>
            <input type="text" id="visualizar-bairro" readonly />
          </div>
          <div class="form-column">
            <label>Número:</label>
            <input type="text" id="visualizar-numero" readonly />
          </div>
        </div>
      </div>

      <!-- Área de exibição da imagem do funcionário -->
      <div class="preview">
        <img id="visualizar-imagem" />
      </div>

      <!-- Linha 6: Complemento -->
      <div class="form-row" id="line-5b">
        <div class="form-column">
          <label>Complemento:</label>
          <textarea id="visualizar-complemento" readonly></textarea>
        </div>
      </div>
    </dialog>

    <!-- Modal para editar dados de um funcionário -->
    <dialog id="modalEditarDialog">
      <!-- Botão para fechar o modal de edição -->
      <button id="closeModalEditar"><i class="fi fi-bs-cross"></i></button>

      <!-- Formulário de edição (início) -->
      <!-- Linha 1: Nome e Nível de Acesso -->
      <div class="form-row" id="line-0c">
        <div class="form-column">
          <label>Nome:</label>
          <input type="text" id="editar-nome" />
        </div>
        <div class="form-column">
          <label>Nível de acesso:</label>
          <input type="text" id="editar-nivelAcesso" />
        </div>
      </div>

      <!-- Linha 2: CPF, Cargo e Data de Admissão -->
      <div class="form-row" id="line-1c">
        <div class="form-column">
          <label>CPF:</label>
          <input type="text" id="editar-cpf" />
        </div>
        <div class="form-column">
          <label>Cargo:</label>
          <input type="text" id="editar-cargo" />
        </div>
        <div class="form-column">
          <label>Data de Admissão:</label>
          <input type="date" id="editar-dataAdmissao" />
        </div>
      </div>

      <!-- Linha 3: Telefone e Email -->
      <div class="form-row" id="line-2c">
        <div class="form-column">
          <label>Telefone:</label>
          <input type="tel" id="editar-telefone" />
        </div>
        <div class="form-column">
          <label>Email:</label>
          <input type="email" id="editar-email" />
        </div>
      </div>

      <!-- Linha 4: Estado, Cidade e CEP -->
      <div class="form-row" id="line-3c">
        <div class="form-column">
          <label>Estado:</label>
          <input type="text" id="editar-estado" />
        </div>
        <div class="form-column">
          <label>Cidade:</label>
          <input type="text" id="editar-cidade" />
        </div>
        <div class="form-column">
          <label>CEP:</label>
          <input type="text" id="editar-cep" />
        </div>
      </div>

      <!-- Linha 5: Rua, Bairro e Número -->
      <div class="form-row" id="line-4c">
        <div class="form-column">
          <label>Rua:</label>
          <input type="text" id="editar-rua" />
        </div>
        <div id="line-4-1c">
          <div class="form-column">
            <label>Bairro:</label>
            <input type="text" id="editar-bairro" />
          </div>
          <div class="form-column">
            <label>Número:</label>
            <input type="text" id="editar-numero" />
          </div>
        </div>
      </div>

      <!-- Área de exibição da imagem -->
      <div class="preview">
        <img id="editar-imagem" />
      </div>

      <!-- Upload de nova imagem (comentado no código original) -->
      <div class="preview-imagem-container">
        <!-- <button type="button" class="botao-upload" id="botaoUploadEditar">Escolher Nova Imagem</button> -->
        <input type="file" id="editar-file-upload" accept="image/*" />
      </div>

      <!-- Linha 6: Complemento e Mensagem de notificação -->
      <div class="form-row" id="line-5c">
        <div class="form-column">
          <label>Complemento:</label>
          <textarea id="editar-complemento"></textarea>
        </div>
        <div class="form-column">
          <!-- <h5>*Para alterar a senha, entre em contato com o administrador</h5> -->
          <h5>*Alteração da imagem está desabilitada por enquanto</h5>
        </div>
      </div>

      <!-- Botão para salvar alterações -->
      <button id="salvarEdicao">Salvar Alterações</button>
    </dialog>

    <!-- Modal para sair/logout -->
    <dialog id="modalLogin">
      <button id="sairLogin">Sair</button>
    </dialog>
  </div>

  <!-- Script para controle dos modais -->
  <script>
    // Seleção dos elementos do DOM
    const dialog = document.querySelector("#modalDialog");
    const openButton = document.querySelector("#openButton");
    const closeModal = document.querySelector("#closeModal");
    const submitModal = document.querySelector("#submitform");
    const visualizarModal = document.querySelector("buttonVisualizar");
    const editModal = document.querySelector("buttonEdit");

    // Evento para abrir modal de adicionar funcionário
    openButton.addEventListener("click", (e) => {
      dialog.showModal();
    });

    // Evento para fechar modal e limpar campos
    closeModal.addEventListener("click", (e) => {
      // Limpa todos os campos do formulário
      document.querySelector("#nome").value = "";
      document.querySelector("#cargo").value = "";
      document.querySelector("#telefone").value = "";
      document.querySelector("#email").value = "";
      document.querySelector("#cpf").value = "";
      document.querySelector("#dataAdmissao").value = "";
      document.querySelector("#senha").value = "";
      document.querySelector("#nivelAcesso").value = "";
      document.querySelector("#rua").value = "";
      document.querySelector("#numero").value = "";
      document.querySelector("#complemento").value = "";
      document.querySelector("#bairro").value = "";
      document.querySelector("#cidade").value = "";
      document.querySelector("#estado").value = "";
      document.querySelector("#cep").value = "";
      document.querySelector("#preview-selected-image").src = "";
      document.querySelector("#file-upload").value = "";

      dialog.close();
    });

    // Configuração do modal de sair/logout
    const dialogLogin = document.querySelector("#modalLogin");
    const openSair = document.querySelector("#imageUser");

    // Evento para abrir modal de logout
    openSair.addEventListener("click", (e) => {
      dialogLogin.showModal();
    });

    // Evento para fechar modal de logout ao clicar fora dele
    dialogLogin.addEventListener("click", (event) => {
      const rectLogin = dialogLogin.getBoundingClientRect();
      if (
        event.clientX < rectLogin.left ||
        event.clientX > rectLogin.right ||
        event.clientY < rectLogin.top ||
        event.clientY > rectLogin.bottom
      ) {
        dialogLogin.close();
      }
    });

    // Evento para fechar modal principal ao clicar fora dele
    dialog.addEventListener("click", (event) => {
      const rect = dialog.getBoundingClientRect();
      if (
        event.clientX < rect.left ||
        event.clientX > rect.right ||
        event.clientY < rect.top ||
        event.clientY > rect.bottom
      ) {
        dialog.close();
      }
    });

    // Funções para realizar a verificação do CEP pelo viacep

    // Função para limpar os campos de endereço
    function limpaFormularioEndereco() {
      document.getElementById('rua').value = "";
      document.getElementById('bairro').value = "";
      document.getElementById('cidade').value = "";
      document.getElementById('estado').value = "";
    }

    // Função pra buscar o endereço pelo CEP
    async function buscarEnderecoPorCEP(cep) {
      cep = cep.replace(/\D/g, '');

      if (cep.length !== 8) {
        limpaFormularioEndereco();
        alert("Formato de CEP inválido.");
        return;
      }

      // Preenche os campos com "..." enquanto consulta
      document.getElementById('rua').value = "...";
      document.getElementById('bairro').value = "...";
      document.getElementById('cidade').value = "...";
      document.getElementById('estado').value = "...";

      try {
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const data = await response.json();

        if (!data.erro) {
          document.getElementById('rua').value = data.logradouro || "";
          document.getElementById('bairro').value = data.bairro || "";
          document.getElementById('cidade').value = data.localidade || "";
          document.getElementById('estado').value = data.uf || "";
        } else {
          limpaFormularioEndereco();
          alert("CEP não encontrado.");
        }
      } catch (error) {
        limpaFormularioEndereco();
        alert("Erro ao buscar o CEP.");
      }
    }

    // Adiciona o evento ao sair do campo de CEP
    document.getElementById('cep').addEventListener('blur', function () {
      buscarEnderecoPorCEP(this.value);
    });

    /* script para aparecer a imagem na tela - comentado sem implementação */
  </script>

  <!-- Script de integração com backend/API -->
  <script src="integracoes/funcionariosIntegration.js"></script>
</body>

</html>